<!DOCTYPE html>
<html>

<head>
    <meta charset="ISO-8859-1">
    <style type="text/css">
        #titletab {
            text-transform: uppercase;
            font-weight: bolder;
            font-size: 35px;
            text-decoration: underline;
        }

        #next-titletab {
            text-transform: uppercase;
            margin-top: 10px;
            font-weight: bold;
            color: #cf368b;
        }

        td .btn-grn {
            display: inline-block;
            width: 80px;
            height: 30px;
            background: #28a745;
            color: white;
            cursor: pointer;
        }
        
        
        .swal-button {
	        background-color: #35b935;
	        color:#fff;
	        box-shadow: none;
	    }
	    
	    .swal-button--cancel{
		    color:#fff;
		    background-color: #f14141;
		    box-shadow: none;
	    }
	    
	     .swal-button:not([disabled]):hover {
	        background-color: #35b935;
	        color:#fff;
	    }
	    
	    .swal-button--cancel:not([disabled]):hover {
		    color:#fff;
		    background-color: #f14141;
        }
        
        .swal-button:active {
        	background-color: #35b935;
	        color:#fff;
        }
        
        .swal-footer{
        	display: flex;
    		justify-content: space-around;
    		gap:250px;
    	}   

	.swal-button:focus {
        	outline: none !important;
        	box-shadow: none !important;
     	 }

        .ead-class {
            color: blue;
            text-decoration: underline;
            font-weight: bold;
            cursor: pointer;
        }

        .smalltexthelp {
            padding-left: 15px;
            margin-top: 20px !important;
            margin-bottom: 20px;
            font-weight: bold;
            text-transform: capitalize;
        }

        .scan-find-label {
            text-transform: uppercase;
            width: 28%;
            text-align: center;
            vertical-align: middle;
            color: blue;
            font-weight: bold;
            margin-top: 20px;
        }

        #overlay {
            position: fixed;
            left: 0%;
            top: 0%;
            z-index: 9999;
            width: 100%;
            background: rgba(255, 255, 255, .7);
            height: 100%;
        }

        #loader {
            position: fixed;
            display: block;
            left: 50%;
            top: 48%;
            z-index: 9999;
            width: 100%;
            height: 100%;
            background-image: url(images/report/loader.gif);
            background-repeat: no-repeat;
            margin: -77px 0 0 -75px;
        }

        a.nav-link,
        a.nav-link:hover {
            font-weight: bold;
            color: black;
            text-transform: uppercase;
            font-size: 20px;
        }

        .nav-pills .nav-link.active,
        .nav-pills .show>.nav-link {
            background: #0a3052 !important;
        }

        table.dataTable thead th,
        table.dataTable td {
            word-break: break-word;
        }

        .ta-left {
            text-align: left;
        }

        .form-control[readonly] {
            background: white !important;
        }

        .ui-widget-content .ui-icon {
            background-image: url(images/report/ui-icons_222222_256x240.png) !important;
        }

        #documentFileTxt {
            cursor: not-allowed;
            background: white;
            width: 100%;
            height: 38px;
            border: 1px solid #ced4da;
            padding: 10px;
        }

        .upload-btn {
            display: inline-block;
            background: rgb(153, 153, 153);
            color: rgb(255, 255, 255);
            padding: 3px 15px;
            font-size: 13px;
            border-radius: 3px;
            cursor: pointer;
            overflow: hidden;
            position: absolute;
            right: 25px;
            top: 6px;
        }

        .view-btn {
            display: inline-block;
            background: rgb(153, 153, 153);
            color: rgb(255, 255, 255);
            padding: 3px 15px;
            font-size: 13px;
            border-radius: 3px;
            cursor: pointer;
            overflow: hidden;
            position: absolute;
            right: 100px;
            top: 6px;
        }

        .delete-btn {
            display: inline-block;
            background: rgb(153, 153, 153);
            color: rgb(255, 255, 255);
            padding: 3px 15px;
            font-size: 13px;
            border-radius: 3px;
            cursor: pointer;
            overflow: hidden;
            position: absolute;
            right: 25px;
            top: 6px;
        }

        .pdf-icon {
            color: red;
            position: absolute;
            top: 13px;
            left: 25px;
            font-weight: 500;
        }

        .pl-25 {
            padding-left: 25px !important;
        }

        #ooccancelhistorytable tbody tr:hover {
            background: #28a745 !important;
            font-weight: bold;
            cursor: pointer;
            color: white;
        }

        #tooltip {
            position: absolute;
            z-index: 1001;
            display: none;
            border: 2px solid #000;
            color: #fff;
            font-weight: bold;
            border-radius: 5px;
            padding: 10px;
            background-color: #000;
            cursor: pointer;
        }

        .blink-span {
            color: red;
            font-weight: bold;
            text-transform: uppercase;
        }

        .blink-span {
            animation: blink-animation 1s steps(5, start) infinite;
            -webkit-animation: blink-animation 1s steps(5, start) infinite;
        }

        @keyframes blink-animation {
            to {
                visibility: hidden;
            }
        }

        @-webkit-keyframes blink-animation {
            to {
                visibility: hidden;
            }
        }
    </style>
</head>

<head lang="en" th:replace="header :: header"></head>

<body>
<div id="overlay" style="display: none;">
        <div id="loader">
        <div style="font-size: 20px; padding-top:5%"><b>Please wait...</b>
</div>   </div> </div>
    <div class="mt-3" style="background-color: #f8f9fa; padding: 15px;">
        <div align="center">
            <span id="titletab" class="form_txt" th:text="${'UPLOAD DOC AND QUERY REPLY - '+session.data2}"></span>
            <h4 id="next-titletab" class="form_txt">record the reply received from the recipient physically for the customs query</h4>
        </div>
        <ul class="nav nav-pills" role="tablist" style="width: 100%; border: 2px solid; border-radius: 7px; margin-bottom: 20px; margin-top: 20px;">
            <li onclick="showQueryReply('start')" class="nav-item" style="width: 50%; text-align: center;"><a class="nav-link active show" data-toggle="pill" href="javascript:;">Query Reply</a></li>
            <li onclick="showQueryReply('history')" class="nav-item" style="width: 50%; text-align: center;"><a class="nav-link" data-toggle="pill" href="javascript:;">Query Reply History</a></li>
        </ul>
        <div id="queryReplyDiv">
            <div class="" style="display: flex; justify-content: center;">
                <div style="padding: 6px;">
                    <input type="text" id="articleIdEntered" placeholder="ENTER ARTICLE ID" class="form-control form_txt" style="font-weight: bold">
                </div>
                <div style="padding: 5px;">
                    <button type="button" onclick="checkQueryRaised()" class="btn btn-success">Submit</button>
                </div>
            </div>
        </div>
        <div id="tooltip"></div>
        <div id="queryReplyHistoryDiv" style="display:none;">
            <div class="row" style="margin: 15px;padding-top: 15px;">
                <span style="font-weight: bold;margin: 0;color: blue;text-transform: capitalize;position: relative;top: 5px;">
                    Select Date Range:
                    <p style="margin: 0;font-size: 12px;color: #bb0e0e;">(Date Of Recording of Query Reply received physically, in this module)</p>
                </span>
                <div class="col-sm-2" style="display: flex;">
                    <p style="font-weight: bold;margin: 0;margin-right: 20px;position: relative;top: 5px;">From:</p>
                    <input type="text" id="fromdatepicker" style="width: 100%;font-weight: bold;text-align: center;" placeholder="Select From Date" readonly="" class="picker form-control form_txt change">
                </div>
                <div class="col-sm-2" style="display: flex;">
                    <p style="font-weight: bold;margin: 0;margin-right: 20px;position: relative;top: 5px;">To:</p>
                    <input type="text" id="todatepicker" style="width: 100%;font-weight: bold;text-align: center;" placeholder="Select To Date" readonly="" class="picker form-control form_txt change">
                </div>
                <button type="button" onclick="getQueryReplyHistory()" class="btn btn-success">Submit</button>
                <button type="button" onclick="resetQueryReplyHistory()" class="btn" style="margin-left: 10px;background: #d14e4e;color: white;">Reset</button>
            </div>
            <small class="form-text text-muted smalltexthelp" style="color: blue !important;"><span style="color: red;">**</span>
                Note : Recording of Query Replies entered in the module during the current month only is listed below. Select Date range for the previous period of Recording of Query Reply.</small>
            <div class="col-md-12">
                <table id="queryreplyhistorytable" class="table table-striped table-bordered mt-3 newtable" style="font-size: 16px; text-align: center;table-layout: fixed;">
                    <thead style="background-color: #a1c4e6;">
                        <tr>
                            <th scope="col" style="text-align: center; vertical-align: middle; width:40px;">S.NO</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">ARTICLE ID</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">ARTICLE DATE</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">ORIGIN COUNTRY</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">MAIL CLASS</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">ITEM CATEGORY</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">ARRIVAL OOE DATE</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">DESTINATION FPO DATE</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">REPLY DATE</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">SSOID OF OFFICER ENTERED</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">QUERY TYPE</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">ACTION</th>
                            <th scope="col" style="text-align: center; vertical-align: middle;">CURRENT STATUS</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>


    <div id="qryreplymodal" class="modal fade" tabindex="-1" style="overflow-y: auto;" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document" style="max-width: 95%;">
            <div class="modal-content">
                <div class="modal-header" style="padding-top: 5px;padding-bottom: 5px;background: #f4f9ff;">
                    <h5 class="modal-title" style="font-weight: bold;">QUERY REPLY</h5>
                    <button type="button" class="close" data-dismiss="modal" onclick="removeContent()" aria-label="Close">
                        <span aria-hidden="true">x</span>
                    </button>
                </div>
                <div class="modal-body" id="qryreplycontent" style="background: #b8daff;">
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [day, month, year].join('/');
        }

        var firstDay;
        var lastDay;

        function currentDate() {
            var date = new Date(),
                y = date.getFullYear(),
                m = date.getMonth();
            firstDay = new Date(y, m, 1);
            lastDay = new Date(y, m + 1, 0);
        }

        currentDate();

       /* $(function() {
            $("#fromdatepicker").datepicker({
                dateFormat: "dd/mm/yy",
                onSelect: function(date) {
                    $("#todatepicker").datepicker('option', 'minDate', date);
                }
            });

            $("#todatepicker").datepicker({
                dateFormat: "dd/mm/yy"
            });
        });*/
        
        
        
         $(function() {
    var currentDate = new Date();

    $("#fromdatepicker").datepicker({
        dateFormat: "dd/mm/yy",
        maxDate: currentDate,
        onSelect: function(date) {
           
            $("#todatepicker").datepicker('option', 'minDate', date);
        }
    });

    $("#todatepicker").datepicker({
        dateFormat: "dd/mm/yy",
        maxDate: currentDate,
        onSelect: function(date) {
            
            $("#fromdatepicker").datepicker('option', 'maxDate', date);
        }
    });
});

        
        function resetQueryReplyHistory() {
            var fromDateInput = document.getElementById("fromdatepicker");
var toDateInput = document.getElementById("todatepicker");

 var fromDate=formatDate(firstDay);
 var toDate=formatDate(lastDay);
fromDateInput.value = fromDate;
toDateInput.value = toDate;
            $("#queryreplyhistorytable").DataTable().ajax.url('getqryreplyarticleshistory?fromDate=' + formatDate(firstDay) + '&toDate=' + formatDate(lastDay)).load();
          
        }


      

        function showLoader() {
            $("#overlay").css("display", "block");
        }

        function hideLoader() {
            setTimeout(function() {
                $("#overlay").css("display", "none");
            }, 500);
        }

        hideLoader();

        function checkQueryRaised() {
            showLoader();
            $.ajax({
                url: "checkqueryraised?itemId=" + $("#articleIdEntered").val(),
                type: "get",
                success: function(data) {
                    hideLoader();
                    if (data.articleNotFound) {
                        swal('OOPS!', 'Incorrect Article Id !', 'error');
                        return false;
                    }
                    if (!data.siteMatch) {
                        swal('OOPS!', 'Site Not Matched !', 'error');
                        return false;
                    }
                    if (data.addtionalqueryRaised && !data.addtionalqueryRaisedReplied) {
                        $.ajax({
                            url: "additionalqueryreply?cinNo=" + data.cinNo + "&articleStage=" + data.qryType,
                            type: "get",
                            success: function(data) {
                                $("#qryreplycontent").html(data);
                                $("#qryreplymodal").find('h5').text('RECORD ADDITIONAL QUERY REPLY & UPLOAD DOCUMENTS AS RECEIVED FROM RECIPIENT');
                                $("#qryreplymodal").modal('show');

                            },
                            error: function(rs, e) {
                                swal('OOPS!', 'Something went wrong. Please try afer sometime !!', 'error');
                            }
                        });
                    } 
                    else if (data.queryRaised && !data.queryRaisedReplied) {
                        $.ajax({
                            url: "queryreply?cinNo=" + data.cinNo,
                            type: "get",
                            success: function(data) {
                                $("#qryreplycontent").html(data);
                                $("#qryreplymodal").find('h5').text('RECORD QUERY REPLY & UPLOAD DOCUMENTS AS RECEIVED FROM RECIPIENT');
                                $("#qryreplymodal").modal('show');
                                $('#recassPopup').modal('hide');
                            },
                            error: function(rs, e) {
                                swal('OOPS!', 'Something went wrong. Please try afer sometime !!', 'error');
                            }
                        });
                    } else if ((data.queryRaised && data.queryRaisedReplied) || (data.addtionalqueryRaised && data.addtionalqueryRaisedReplied)) {
                        swal('OOPS!', 'Query replied already for entered article !', 'error');
                    } else if (!data.queryRaised || !data.addtionalqueryRaised) {
                        swal('OOPS!', 'Query not raised for entered article !', 'error');
                    } else {
                        swal('OOPS!', 'Something went wrong. Please try afer sometime here1 !!', 'error');
                    }
                },
                error: function(rs, e) {
                    hideLoader();
                    swal('OOPS!', 'Something went wrong. Please try afer sometime here2 !!', 'error');
                }
            });
        }

        function viewQueryReply(obj) {
            var txtMsg = $(obj).attr('textMsg');
            $.ajax({
                url: $(obj).attr('url'),
                type: "get",
                success: function(data) {
                    $("#qryreplycontent").html(data);
                    $("#qryreplymodal").find('h5').text(txtMsg);
                    $("#previewKycSectionDiv").next().remove();
                    $("#qryreplymodal").modal('show');

                },
                error: function(rs, e) {
                    swal('OOPS!', 'Something went wrong. Please try afer sometime !!', 'error');
                }
            });
        }

        function removeContent() {
            $('#qryreplycontent').html('');
        }

        function showQueryReply(txt) {
            if (txt == 'start') {
                $("#queryReplyHistoryDiv").hide();
                $("#queryReplyDiv").show('slow');
            } else if (txt = 'history') {
                $("#queryReplyHistoryDiv").show();
                $("#queryReplyDiv").hide('slow');
            }
        }
    </script>
</body>
<script src="js/qryrplyoff.js"></script>
</html>