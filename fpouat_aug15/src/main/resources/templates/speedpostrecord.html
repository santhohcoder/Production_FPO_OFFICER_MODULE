<div id="pushdcallshow" class="col-md-12">


<div align="center" style="margin-bottom: 1rem;margin-top: 1rem;">
				<span id="titletab" class="form_txt " style="font-size: x-large;color: #17a2b8;">Enter Speed Post Consign.No of D-Call Letter Dispatched</span>
			</div>
		<div class="col-md-12" style="margin-left: -29px; margin-bottom: 20px;">
 	<label class="form_txt col-md-9"> Total D-call Letter </label>
   	<span style="margin-left: -76rem;" class="form_txt box-span" th:text="${size}">0</span>
</div>		
			<!-- <div>
			<button id="speedpostnostatus" style="color: #fff;background-color: #17a2b8;border-color: #17a2b8;">Speed Post Consign.No History</button>
			</div> -->
 <table id="dcallhisttable" class="table table-striped table-bordered newtable"
               style="font-size: 16px; text-align: center;width: 100%;">
				<thead style="background-color: #a1c4e6;">
					<tr>
						<th scope="col" id="sinid" style="width: 45px;">Sl.No.</th>
						<th scope="col" style="text-align: center;">Article Id</th>
						<th scope="col" style="text-align: center;">Receiver Name</th>
						<th scope="col" style="text-align: center;">Receiver Address</th>
						<th scope="col" style="text-align: center;">DCALL Letter No</th>
						<th scope="col" style="text-align: center;">DCALL Letter Date</th>
						<th scope="col" class="consignt"style="text-align: center;">Enter Speed Post Consign.No <br>( e.g. EK702078015IN)</th>
						<th scope="col" style="text-align: center;"></th>
						<th scope="col" style="text-align: center;">Id</th>
						
<!-- 					<th scope="col" style="text-align: center;">Id</th> -->
						<!-- 
						<th scope="col" style="text-align: center;">Posting Date</th>
						<th scope="col" style="text-align: center;">Query Stage</th>
						<th scope="col" style="text-align: center;" th:if="${ history != null  }">OOC Status</th>
						<th scope="col" style="text-align: center;">Mail Class</th>
						<th scope="col" style="text-align: center;">Origin Country</th>
						<th scope="col" style="text-align: center;">Printed *</th>
						<th scope="col" style="text-align: center;">Sent SMS</th>
						<th scope="col" style="text-align: center;">Sent Mail</th>
                        <th scope="col" style="text-align: center;">Action</th> -->
					</tr>
				</thead>
				<tbody>
					<tr th:each="values,iter :  ${dcallhistory}" class=""  >
						 <td  ></td>
						 <td class="pdfview" onclick="pdfview(this)"  th:text="${values.item_id}"  id="itemidmodal"  th:data-mail1="${values.mail_to}" th:data-mail2="${values.mail_cc}" th:data-mob1="${values.mobile_no_1}" th:data-mob2="${values.mobile_no_2}"  th:data-recp_name="${values.recp_name}" th:data-dcall_no="${values.dcall_no}" th:data-full_path="${values.full_path}" th:data-filename="${values.gen_filename}" th:data-cinno="${values.cin_no}" th:data-itemid="${values.item_id}" ></td>
			             <td  th:text="${values.recp_name}"></td>
			             <td  th:text="${values.recp_add1}"></td>
			             <td  th:text="${values.dcall_no}"></td> 
			             <td  th:text="${values.gen_dt}"></td>
<!-- 					  <td > <input type="text" class="speedpostno"  maxlength="13"  id="upcs"  placeholder="Enter Speed Post Consign.No" style="width: 215px;" />  <br>      -->
<!--   			            <input id="calender" placeholder="Select Date" class="form_txt active_since ml-2" type="text" name="fromdate" readonly style="display: inline;width: 115px;">  </td>   -->
			       
 			       <td  ><input th:id="${iter.index+1}" type="text" class="speedpostno spedd"  maxlength="13"    placeholder="Enter Speed Post Consign.No" style="width: 215px;"/> </td>
 			       <td  ><input  placeholder="Select Date"  class="calender1 form_txt active_since ml-2" type="text" name="fromdate" readonly style="display: inline;width: 115px;" disabled/></td>  
			       <td  th:text="${values.id}"></td>
			             
			             
<!-- 			             <td  th:text="${values.id}"></td> id="consdt" --> 
			             <!-- <td  th:text="${values.post_dt}"></td>
			             <td  th:text="${values.qryname}"></td>
			             <td th:if="${ history != null  }"  th:text="${values.ooc}"></td> text-transform:uppercase
			             <td  th:text="${values.mail_class}"></td>
			             <td  th:text="${values.origin_country}"></td>
			             
			             <td style="text-align: left;"  th:if="${values.printcou > 0}"><p id="infoprint">&#9989;<strong class='printcou' th:unless="${values.printcou == null}" th:text="' (' + ${values.printcou}+')'"></strong></p></td>
			             <td style="text-align: left;" th:unless="${values.printcou > 0}"><p id="infoprint">&#10060;</p></td>
			             
			             <td style="text-align: left;"  th:if="${values.smscou == null}" ><p id="infosms">&#10060;</p></td>
			             <td class="pdfview" onclick="sentdetail(this,'SMS')" th:data-gen_dt="${values.gen_dt}" th:data-dcall_no="${values.dcall_no}" th:data-itemid="${values.item_id}" style="text-align: left;" th:unless="${values.smscou == null}" ><p id="infosms">&#9989;<strong class='smscou' th:text="' (' + ${values.smscou}+')'"></strong></p></td>
			             
			             <td style="text-align: left;" th:if="${values.emailcou == null}" ><p id="infomail">&#10060;</p></td>
			             <td class="pdfview" onclick="sentdetail(this,'EMAIL')" th:data-gen_dt="${values.gen_dt}" th:data-dcall_no="${values.dcall_no}" th:data-itemid="${values.item_id}" style="text-align: left;" th:unless="${values.emailcou == null}" ><p id="infomail">&#9989;<strong class='emailcou' th:text="' (' + ${values.emailcou}+')'"></strong></p></td>
					   <td> 
					   <button onclick="pdfview(this)" id="viewprint" th:data-mail1="${values.mail_to}" th:data-mail2="${values.mail_cc}" th:data-mob1="${values.mobile_no_1}" th:data-mob2="${values.mobile_no_2}" th:data-din1="${values.din1}" th:data-recp_name="${values.recp_name}" th:data-dcall_no="${values.dcall_no}" th:data-full_path="${values.full_path}" th:data-filename="${values.gen_filename}" th:data-cinno="${values.cin_no}" th:data-itemid="${values.item_id}" type="button" class="" style="color: #fff;background-color: #17a2b8;border-color: #17a2b8;">VIEW</button>
					   <button  id="vprint" th:data-mail1="${values.mail_to}" th:data-mail2="${values.mail_cc}" th:data-mob1="${values.mobile_no_1}" th:data-mob2="${values.mobile_no_2}" th:data-din1="${values.din1}" th:data-recp_name="${values.recp_name}" th:data-dcall_no="${values.dcall_no}" th:data-full_path="${values.full_path}" th:data-filename="${values.gen_filename}" th:data-cinno="${values.cin_no}" th:data-itemid="${values.item_id}" type="button" class="vprint" style="color: #fff;background-color: #17a2b8;border-color: #17a2b8;">PRINT</button>
					   <button onclick="smsmodal(this)" id="sms" th:data-mail1="${values.mail_to}" th:data-mail2="${values.mail_cc}" th:data-mob1="${values.mobile_no_1}" th:data-mob2="${values.mobile_no_2}" th:data-din1="${values.din1}" th:data-recp_name="${values.recp_name}" th:data-dcall_no="${values.dcall_no}" th:data-full_path="${values.full_path}" th:data-filename="${values.gen_filename}" th:data-cinno="${values.cin_no}" th:data-itemid="${values.item_id}" type="button" class="" style="color: #fff;background-color: #17a2b8;border-color: #17a2b8;">SMS</button>
					   <button  id="mail" th:data-mail1="${values.mail_to}" th:data-mail2="${values.mail_cc}" th:data-mob1="${values.mobile_no_1}" th:data-mob2="${values.mobile_no_2}" th:data-din1="${values.din1}" th:data-recp_name="${values.recp_name}" th:data-dcall_no="${values.dcall_no}" th:data-full_path="${values.full_path}" th:data-filename="${values.gen_filename}" th:data-cinno="${values.cin_no}" th:data-itemid="${values.item_id}" type="button" class="mail" style="color: #fff;background-color: #17a2b8;border-color: #17a2b8;">EMAIL & SMS</button>
					   </td>   onkeypress="return postnoFunction(this,event)"   return chancase(iter)       onkeypress="this.val(chancase(iter))"                      -->
					</tr>
				</tbody>
			</table>
		<div align="center" class="mb-3 pb-3 btn-lg">
			<button id="updatespeedpostno" class="btn btn-primary" style=" color: #fff;background-color: #007bff;border-color: #007bff;">Submit</button>
			</div>
		</div>
		
		<script>
		
		$("#dcallhisttable").dataTable({
		"processing": true,
		"paging": false,
		scrollY: '45vh',
		scrollCollapse: true,
		scrollX: true,
		"dom": '<"pull-left"Bl>frtip',
		buttons: [{extend: "excel", text: '<i>EXCEL</i>',
				   className: 'btn btn-primary mb-3',
				   title:'FPO IMPORT APPLICATION - ICES',
					filename:' Enter Speed Post Consign.No of D-Call Letter Dispatched',
					message:' Enter Speed Post Consign.No of D-Call Letter Dispatched @ ' + sitecode + '\n\r' + datetime,
					exportOptions: {
        				columns: [ 0,1,2,3,4,5,6],
						margin: true,
      						}, 
					//customize: function (doc) {}
					},
				//pdf
    			  {extend: 'pdf',
				    text:'<i>PDF</i>',
				    pageSize: 'A4',
					watermark:'fpo',
                    className: ' btn btn-success mb-3 ',				
				    orientation: 'landscape',
				    exportOptions: {
        				columns: [ 0,1,2,3,4,5,6],
						margin: true,
      						}, 
		   		    customize: function(doc, header) {
		   		    doc.content[1].table.widths = ['11%','15%','15%','15%','15%','15%','15%'];
				   	doc.defaultStyle.alignment = 'center'
					 //doc.styles.tableHeader.fillColor='#ADD8E6',
					 doc.styles.tableHeader = {
        						color: '#2D1D10',
								fillColor:'#ADD8E6',
        						fontSize: '10',
        						alignment: 'center'
    						},
					doc.content.splice(1, 0,{
					text: [{text:' Date:'+ datetime, bold: true,
					alignment: 'right',
					fontSize: 7,
					margin:[0,20,0,20],
					//watermark:'fpo', 
					},],});
					doc.content.splice(1, 0,{
          			text: [{text:' SSO ID: ' + empid, bold: true,
					alignment: 'left',
					fontSize: 7,
					margin:[0,0,90,20],
					//watermark:'fpo', 
					},],}); 
					//doc.style.tableHeader		
					doc.defaultStyle.fontSize = 5;
					doc.styles.title.bold=true;
					doc.styles.title.fontSize=15;
					doc.styles.title.alignment="center",
					doc.styles.message.fontSize = 9;
					doc.styles.message.bold=true;
					//doc.styles.message.alignment = "right";
					doc.styles.tableHeader.fontSize= 6;
					doc.styles.tableHeader.bold=true;
					doc['footer']=(function(page, pages) {
							return {
								columns: ['',{
								alignment: 'right',
										text: ['Page  ',{ text: page.toString(), italics: true,fontSize:7},'  of ',
											{ text: pages.toString(), italics: true,fontSize:6 }],italics: true, fontSize:6  }],
										margin: [15, 0]}});
    		        },
			
			title: 'FPO IMPORT APPLICATION - ICES'+
							'\n\r'+' Enter Speed Post Consign.No of D-Call Letter Dispatchedr @ ' + sitecode,
           			//message: empid,
					//message:datetime, 
					filename:' Enter Speed Post Consign.No of D-Call Letter Dispatched ',
},
			//Print
		         {extend: "print" ,
				  className: 'btn btn-danger mb-3',
				  title: 'FPO IMPORT APPLICATION - ICES',
			      text: '<i>PRINT</i>',
				  message:' Enter Speed Post Consign.No of D-Call Letter Dispatched @ ' + sitecode + '\n\r' + datetime ,
					filename:' Enter Speed Post Consign.No of D-Call Letter Dispatched',
					exportOptions: {
        				columns: [ 0,1,2,3,4,5,6],
						margin: true,
      						}, 
					customize: function ( win ) {
					console.log("sucess");
						$(win.document.body).css( 'font-size', '8pt' )
						$(win.document.body).find( 'table' ).css( 'font-size', 'inherit' );
						},	}],
		
		
		"initComplete": function( settings ) {
	     $("#dcallhisttable_filter").append('<button type="button" class="btn btn-info" id="clear6" '+
			'style="margin-left: 15px;margin-bottom: 5px;">Clear</button>');
          $("#dcallhisttable_filter input[type='search']").attr('id', 'searchdcallhisttable');
		$('#clear6').click(function() {	
		document.getElementById("dcallhisttable").value=""
		var table = $('#dcallhisttable').DataTable();
		table.search('').draw();
	   })
    	}
	});
			

	$('#dcallhisttable').DataTable().on('order.dt search.dt', function() {
		$('#dcallhisttable').DataTable().column(0, {
			search: 'applied',
			order: 'applied'
		}).nodes().each(function(cell, i) {
			cell.innerHTML = i + 1;
			
		});
	}).draw();
	
	$('#dcallhisttable').DataTable().columns(8).visible(false);
	
 
   
 /* function Speedpostnum(element){
   console.log(element);
   alert("column" + element.parentNode.parentNode.rowIndex + 
         " - row" + element.parentNode.cellIndex);}*/
   
function  getId(element) {
   
  
    var row = $(element.closest('tr').rowIndex);
    console.log(row);
    var colomn = $(element.closest('td').cellIndex);
    console.log(colomn);
    
    var val = $("#dcallhisttable").find('tr').eq(row).find('td:eq(6)').val();
    //var j = 
    console.log(x);
    
    if(x<=13){
    	$('.calender1').attr('disabled',false);
    	}
    	else{
    	$('.calender1').attr('disabled',true);
    	}
}
$('.calender1').mousedown(function() {

//alert($(this).attr('id1'));
//var x= $(this).attr('id1');
//console.log(x);

});
 
 
   
$('.spedd').keyup(function() {
$(this).val($(this).val().toUpperCase());
 	var speedval  = ($(this).val());
 	var len = speedval.length;
 	console.log(len);
 			
 			//alert($(this).closest('tr').rowIndex);
 			//alert($(this).attr('id'));
		 	var char_Pas  = speedval.substr(0, 2);
	 		var let_Pas  =speedval.substr(2, 9);
	 		var char_con = speedval.substr(11, 1);
	 		var char_con1 = speedval.substr(12, 1);
	 		$('.calender1').attr('disabled',true);
				if (len == 1){
				this.value = this.value.replace(/[^A-Z]/g, '');
				}
				else if (len ==2){
					this.value = this.value.replace(/[^A-Z]/g, '');	
				}
				else if (len ==3){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len ==4){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');	
				}
				else if (len ==5){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len ==6){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len ==7){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len ==8){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len ==9){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len ==10){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len ==11){
					this.value = char_Pas + this.value.replace(/[^0-9]/g, '');
				}
				else if (len==12){
				if (!(char_con >= 'A' && char_con <= 'Z')) {
					if (char_con >='a' && char_con <='z') { 
				     	char_con = char_con.toUpperCase();
					 	this.value =  char_Pas + let_Pas + char_con ;}
					else {
				 			this.value = char_Pas + let_Pas;}
				 		}
				    else {	  
				      		this.value =  char_Pas + let_Pas + char_con;
				      		var x= $(this).attr('id');
					 		$("#dcallhisttable").find('tr').eq(x).find("input.calender1").val('');}  	
					}
			   		else if (len ==13){
				    	if (!(char_con1 >= 'A' && char_con1 <= 'Z')) {
						if (char_con1 >='a' && char_con1 <='z') { 
				     		char_con = char_con.toUpperCase();
					 		this.value =  char_Pas + let_Pas + char_con + char_con1 ;}
					else {
				 		 	this.value = char_Pas + let_Pas + char_con;}
				 			}
				     else {	  
				       		this.value =  char_Pas + let_Pas + char_con + char_con1;
				       		var x= $(this).attr('id');
				       		$("#dcallhisttable").find('tr').eq(x).find("input.calender1").attr('disabled',false);
				      
				 			}  	
							}
						});
 


$('#updatespeedpostno').on('click', function() {

       var cells1 = [];
       var rows = $("#dcallhisttable").dataTable().fnGetNodes();
       var tabledata = $('#dcallhisttable').DataTable().rows().data();
       var res=1;
       for (var i = 0; i < rows.length; i++) {
              result = [];
              table = $('#dcallhisttable').DataTable();
              var result1 = {};
              var speedpostno = $(rows[i]).find("td:eq(6) .speedpostno").val();
              
              //var activesince = $(rows[i]).find("td:eq(6) .active_since").val();
              var activesince = $(rows[i]).find("td:eq(7) .active_since").val();
              result1["speedpostno"] = speedpostno;
              result1["activesince"] = activesince;
              
              result1["id"] = tabledata[i][8];
              
                            console.log(speedpostno);
              
              if(speedpostno.length == 13 && speedpostno != null && speedpostno != 'undefined' && speedpostno != '' && speedpostno != 'null' && speedpostno != undefined && activesince != null && activesince != 'undefined' && activesince != '' && activesince != 'null' && activesince != undefined){
              	cells1.push(result1);
              }else{
              	res = 0;
              }
              
              if(speedpostno == '' && activesince == ''){
              	res=1;
              }else if(speedpostno == '' && activesince != ''){
              	res=0;
              }else if(speedpostno != '' && activesince == ''){
              	res=0;
              }
              


       }

		if(res == 1 && cells1.length > 0){
       		console.log(cells1);
       		updateSpeedPostNo(cells1);
		}else{
          	swal('OOPS!', 'Please Enter Valid Speed Post Number and Date!', 'warning');
        }
});
        

function updateSpeedPostNo(cells1) {
       var oMyForm = new FormData();
       oMyForm.append("wholeupdate", cells1);
       console.log(JSON.stringify(cells1));
       jQuery.ajax({
              url: "updateSpeedPostNo",
              global: false,
              data: JSON.stringify(cells1),
              dataType: 'json',
              processData: false,
              contentType: "application/json; charset=utf-8",
              type: 'POST',
              success: function(response) {
                     $("#speedpost").trigger("click");
              }

       });

}

	
$('#speedpostnostatus').on('click', function() {

	showLoader();
	var oMyForm = new FormData();
	oMyForm.append("fromdate", $('#fromdate').val());
	oMyForm.append("todate", $('#todate').val());

	$.ajax({
		url: "speedpostrecordstatus",
		global: false,
		data: oMyForm,
		dataType: 'text',
		processData: false,
		contentType: false,
		type: 'POST',
		success: function(data) {
			$('#pushdcallshow').replaceWith(data);
			hideLoader();
		},
		error: function(rs, e) {
			swal('OOPS!', 'Something went wrong. Please try afer sometime !!', 'error');
			hideLoader()
		}
	});
       
});

function postnoFunction(obj,objevent){

	var length = obj.value.length;
	
	var keyCode = objevent.which ? objevent.which : objevent.keyCode;

	var success=1;
	
/*	if ( length > 13)
	  return true;
	else
	  return false;
	
	if(length == 0){
		if(keyCode >= 65 && keyCode <= 90 ){
        	success=1;
        }
	}
	
	if(length == 1){
		if(keyCode >= 65 && keyCode <= 90 ){
        	success=1;
        }
	}
	
	if(length == 2){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 3){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 4){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 5){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 6){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 7){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 8){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 9){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 10){
		if(keyCode >= 48 && keyCode <= 57 ){
			success=1;
		}
	}
	
	if(length == 11){
		if(keyCode >= 65 && keyCode <= 90 ){
        	success=1;
        }
	}
	
	if(length == 12){
		if(keyCode >= 65 && keyCode <= 90 ){
        	success=1;
        }
	}
	*/
	if(success == 1){
		return true;
	}else{
		return false;
	}
	
}


	var sndate = new Date();
	var mindate = moment(sndate).format("DD/MM/YYYY");
	
	$(".active_since").datepicker({
		dateFormat: "dd/mm/yy"
	});
	
//	$(".active_since").val(mindate);
		</script>